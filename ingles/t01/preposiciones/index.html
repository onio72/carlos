<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prepositions of Place Trainer</title>
<style>
  :root{
    --bg:#f7f9fc;--card:#fff;--ink:#0f172a;--muted:#475569;
    --ok:#16a34a;--ko:#dc2626;--border:#e5e7eb;
    --shadow:0 6px 20px rgba(2,6,23,.08);--r:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink)}
  .wrap{max-width:920px;margin:clamp(12px,4vw,48px) auto;padding:clamp(12px,3vw,28px)}
  header{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:18px}
  h1{margin:0;font-size:clamp(18px,3vw,30px)}
  .chip{font-size:12px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;margin-left:6px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:clamp(16px,3vw,28px)}
  .es{padding:14px 16px;border:1px solid var(--border);border-radius:12px;background:#fafafa}
  .es small{color:var(--muted)}
  input[type="text"]{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font:inherit}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  button{padding:10px 16px;border-radius:12px;border:1px solid var(--border);background:var(--ink);color:#fff;cursor:pointer;font-weight:700;box-shadow:var(--shadow)}
  button.secondary{background:#fff;color:var(--ink)}
  button:disabled{opacity:.45;cursor:not-allowed}
  .score{margin-top:10px;font-weight:800}
  .score.ok{color:var(--ok)}.score.ko{color:var(--ko)}
  .fb{margin-top:12px}.ok{color:var(--ok);font-weight:700}.ko{color:var(--ko);font-weight:700}
  .ended{background:#ecfeff;border-color:#bae6fd}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Prepositions of Place Trainer</h1>
    <div>
      <span class="chip">+0.25 acierto</span>
      <span class="chip">−0.25 error</span>
      <span class="chip">Objetivo: 10.00</span>
      <span class="chip" id="leftChip"></span>
    </div>
  </header>

  <section class="card" id="taskCard">
    <div class="es" id="esBox"><small>Frase en español</small><br>—</div>
    <input id="answer" type="text" placeholder="Write the full sentence in English…">

    <div class="controls">
      <button id="checkBtn">Corregir</button>
      <button id="nextBtn" class="secondary">Otro ejercicio</button>
    </div>
    <div class="score" id="scoreBox">Nota: 0.00 / 10</div>
    <div id="feedback" class="fb"></div>
  </section>
</div>

<script>
/* === Banco de frases === */
const BANK = [
  // ON
  {es:"El gato está sobre la mesa.", en:"The cat is on the table."},
  {es:"El libro está sobre la caja.", en:"The book is on the box."},

  // IN
  {es:"El gato está dentro de la caja.", en:"The cat is in the box."},
  {es:"El perro está en el coche.", en:"The dog is in the car."},

  // UNDER
  {es:"El gato está debajo de la mesa.", en:"The cat is under the table."},
  {es:"El libro está debajo de la caja.", en:"The book is under the box."},

  // BETWEEN
  {es:"El gato está entre las cajas.", en:"The cat is between the boxes."},
  {es:"La pelota está entre la mesa y la silla.", en:"The ball is between the table and the chair."},

  // ABOVE
  {es:"El póster está encima de la ventana (sin tocarla).", en:"The poster is above the window."},
  {es:"El avión está sobre las nubes.", en:"The plane is above the clouds."},

  // BEHIND
  {es:"El gato está detrás de la caja.", en:"The cat is behind the box."},
  {es:"La silla está detrás de la mesa.", en:"The chair is behind the table."},

  // IN FRONT OF
  {es:"El gato está delante de la caja.", en:"The cat is in front of the box."},
  {es:"El niño está delante de la pizarra.", en:"The boy is in front of the board."},

  // NEXT TO
  {es:"El gato está al lado de la caja.", en:"The cat is next to the box."},
  {es:"La lámpara está al lado de la cama.", en:"The lamp is next to the bed."},

  // OPPOSITE
  {es:"El gato está enfrente de la caja.", en:"The cat is opposite the box."},
  {es:"El banco está enfrente del museo.", en:"The bench is opposite the museum."},
  {es:"La escuela está enfrente del parque.", en:"The school is opposite the park."}
];

/* === Utilidades === */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
function norm(s){return (s||"").toLowerCase().replace(/\./g,"").replace(/\btv\b/g,"television").replace(/\s+/g," ").trim();}

/* === Sin repeticiones + bloqueo de corrección múltiple === */
let order = shuffle([...Array(BANK.length).keys()]);
let cursor = 0, current=null, score=0, finished=false, checkedThisItem=false;

const esBox=document.getElementById("esBox");
const ans=document.getElementById("answer");
const scoreBox=document.getElementById("scoreBox");
const checkBtn=document.getElementById("checkBtn");
const nextBtn=document.getElementById("nextBtn");
const feedback=document.getElementById("feedback");
const leftChip=document.getElementById("leftChip");
const card=document.getElementById("taskCard");

function updateLeft(){ leftChip.textContent=`${BANK.length - cursor} restantes`; }

function endSession(msg){
  finished=true; checkBtn.disabled=true; nextBtn.disabled=true;
  card.classList.add("ended");
  esBox.innerHTML=`<small>Fin</small><br>${msg}`;
  feedback.innerHTML=""; updateLeft();
}

function pick(){
  if(finished) return;
  if(cursor>=order.length){ endSession("Has completado todos los ejercicios sin repetir."); return; }
  current = BANK[order[cursor++]];
  esBox.innerHTML = `<small>Frase en español</small><br>${current.es}`;
  ans.value = ""; ans.focus(); feedback.innerHTML = "";
  checkedThisItem = false;             // ← permite corregir UNA sola vez
  checkBtn.disabled = false;           // ← se reactiva para el nuevo ejercicio
  updateLeft();
}

function updateScore(delta){
  score = Math.max(0, Math.min(10, +(score + delta).toFixed(2)));
  scoreBox.className = "score " + (score>=5?"ok":"ko");
  scoreBox.textContent = `Nota: ${score.toFixed(2)} / 10`;
  if(score>=10) endSession("¡Enhorabuena! Has alcanzado 10 puntos.");
}

checkBtn.addEventListener("click", ()=>{
  if(!current || checkedThisItem) return;  // ← evita sumar más de una vez
  const ok = norm(ans.value) === norm(current.en);
  updateScore(ok ? 0.25 : -0.25);
  feedback.innerHTML = ok
    ? `<span class="ok">✔ Correcto</span> — ${current.en}`
    : `<span class="ko">✖ Incorrecto</span> — Solución: ${current.en}`;
  checkedThisItem = true;             // ← marcado como corregido
  checkBtn.disabled = true;           // ← bloquea más pulsaciones
});

nextBtn.addEventListener("click", ()=>{ if(!finished) pick(); });
ans.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); checkBtn.click(); }});

/* Inicio */
pick(); updateScore(0);
</script>
</body>
</html>
